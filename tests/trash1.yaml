  - name: Create an ec2 launch template
    community.aws.ec2_launch_template:
      name: "{{ launch_template_name_web }}"
      image_id: "{{ images }}"
      key_name: "{{ keys }}"
      instance_type: "{{ instancesize_private }}"
      iam_instance_profile: "{{ instance_role }}"
      security_group_ids: "{{ security_group_web_result.group_id }}"      
      default_version: 1
      block_device_mappings:
        - ebs:
            volume_size: 15
            volume_type: magnetic      
      tags:
        name: "asg-web"
    register: launch_template_web_result




  - name: Create an ELB and attach a listener
    community.aws.elb_network_lb:
      name: "{{ lb_name_internal }}"
      subnets: [ "{{ subnet_was1_result.subnet.id }}", "{{ subnet_was2_result.subnet.id }}" ]
      security_groups: [ "{{ security_group_inlb_result.group_id }}" ]
      state: "{{ state }}"
      scheme: "internal"
      listeners:
        - Protocol: TCP 
          Port: 80 
          DefaultActions:
            - Type: forward 
              TargetGroupName: "{{ tg_was_result.target_group_name }}"
    register: inlb_result      


  - name: Configure Elastic Load Balancers
    amazon.aws.elb_application_lb:
      region: "{{ region }}"
      name: "{{ lb_name_internal }}"
      state: "{{ state }}"
      subnets: [ "{{ subnet_was1_result.subnet.id }}", "{{ subnet_was2_result.subnet.id }}" ]
      security_groups: [ "{{ security_group_inlb_result.group_id }}" ]
      scheme: "internal"
      listeners:
        - Protocol: HTTP
          Port: 80
          DefaultActions: 
            - Type: "forward"
              TargetGroupName: "{{ tg_was_result.target_group_name }}"       
    register: inlb_result      